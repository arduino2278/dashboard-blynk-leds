<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard ESP32 ‚Äì LEDs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 30px;
      background: #f2f2f2;
    }
    h1 {
      margin-bottom: 20px;
    }
    button {
      font-size: 18px;
      padding: 15px 25px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .rouge { background: #e74c3c; color: white; }
    .vert  { background: #2ecc71; color: white; }
    .jaune { background: #f1c40f; color: black; }
    .voice { background: #3498db; color: white; }

    #log {
      margin-top: 20px;
      font-size: 16px;
      color: #333;
    }
  </style>
</head>

<body>

<h1>üéõÔ∏è Dashboard ESP32 ‚Äì LEDs</h1>

<!-- Boutons manuels -->
<button class="rouge" onclick="sendToBlynk('V0',1)">Rouge ON</button>
<button class="rouge" onclick="sendToBlynk('V0',0)">Rouge OFF</button><br>

<button class="vert" onclick="sendToBlynk('V2',1)">Vert ON</button>
<button class="vert" onclick="sendToBlynk('V2',0)">Vert OFF</button><br>

<button class="jaune" onclick="sendToBlynk('V1',1)">Jaune ON</button>
<button class="jaune" onclick="sendToBlynk('V1',0)">Jaune OFF</button><br><br>

<!-- Commande vocale -->
<button class="voice" onclick="startRecognition()">üé§ Parler</button>

<p id="log">Commande : ...</p>

<script>
const BLYNK_TOKEN = "K5zBN_DdyUZgc7Jxhb6ac1yKsLyKAjZc";

function sendToBlynk(pin, value) {
  fetch(`https://blynk.cloud/external/api/update?token=${BLYNK_TOKEN}&${pin}=${value}`);
}

/* =======================
   COMMANDE VOCALE STABLE
   ======================= */

let recognition;

function initSpeech() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    document.getElementById("log").innerText =
      "‚ùå Reconnaissance vocale non support√©e";
    return;
  }

  recognition = new SpeechRecognition();
  recognition.lang = "fr-FR";
  recognition.continuous = false;
  recognition.interimResults = false;

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript.toLowerCase();
    document.getElementById("log").innerText = "Commande : " + text;
    processCommand(text);
  };

  recognition.onerror = () => {
    document.getElementById("log").innerText =
      "‚ùå Erreur micro / permission refus√©e";
  };
}

function startRecognition() {
  if (!recognition) initSpeech();
  recognition.start();
}

function processCommand(text) {
  const on  = text.includes("on") || text.includes("allumer");
  const off = text.includes("off") || text.includes("√©teindre");

  if (text.includes("rouge")) {
    sendToBlynk("V0", on ? 1 : off ? 0 : 1);
  }

  if (text.includes("vert") || text.includes("verte")) {
    sendToBlynk("V1", on ? 1 : off ? 0 : 1);
  }

  if (text.includes("jaune")) {
    sendToBlynk("V2", on ? 1 : off ? 0 : 1);
  }
}
</script>

</body>
</html>

