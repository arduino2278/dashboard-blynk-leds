<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard LEDs - Blynk</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: white;
  min-height: 100vh;
}

.card {
  background: rgba(255,255,255,0.12);
  border: none;
  border-radius: 22px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.4);
}

.led {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  margin: 15px auto;
  opacity: 0.25;
  transition: all 0.3s ease;
}

.led.on {
  opacity: 1;
  box-shadow: 0 0 30px currentColor;
}

.red    { background: red;    color: red; }
.yellow { background: gold;   color: gold; }
.green  { background: lime;   color: lime; }

.btn-toggle {
  width: 100%;
  font-size: 1.1rem;
  padding: 10px;
}

@media (min-width: 768px) {
  .led {
    width: 85px;
    height: 85px;
  }
}
</style>
</head>

<body>

<div class="container py-4">
  <h2 class="text-center mb-4">üéõÔ∏è Dashboard LEDs (Blynk)</h2>

  <div class="row g-4">

    <!-- LED ROUGE -->
    <div class="col-12 col-sm-6 col-md-4">
      <div class="card text-center p-4">
        <div id="led0" class="led red"></div>
        <h5>LED Rouge</h5>
        <button class="btn btn-danger btn-toggle" onclick="toggleLed(0)">OFF</button>
      </div>
    </div>

    <!-- LED JAUNE -->
    <div class="col-12 col-sm-6 col-md-4">
      <div class="card text-center p-4">
        <div id="led1" class="led yellow"></div>
        <h5>LED Jaune</h5>
        <button class="btn btn-warning btn-toggle" onclick="toggleLed(1)">OFF</button>
      </div>
    </div>

    <!-- LED VERTE -->
    <div class="col-12 col-sm-6 col-md-4">
      <div class="card text-center p-4">
        <div id="led2" class="led green"></div>
        <h5>LED Verte</h5>
        <button class="btn btn-success btn-toggle" onclick="toggleLed(2)">OFF</button>
      </div>
    </div>

  </div>
</div>

<script>
/* üîê METS ICI TON TOKEN BLYNK */
const BLYNK_TOKEN = "K5zBN_DdyUZgc7Jxhb6ac1yKsLyKAjZc";

/* √©tats locaux */
let states = [0, 0, 0];

/* Mise √† jour visuelle */
function updateUI(pin, value) {
  const led = document.getElementById("led" + pin);
  const btn = led.parentElement.querySelector("button");

  states[pin] = value;

  if (value === 1) {
    led.classList.add("on");
    btn.textContent = "ON";
  } else {
    led.classList.remove("on");
    btn.textContent = "OFF";
  }
}

/* Envoi commande vers Blynk */
function toggleLed(pin) {
  const newState = states[pin] === 1 ? 0 : 1;

  fetch(`https://blynk.cloud/external/api/update?token=${BLYNK_TOKEN}&V${pin}=${newState}`)
    .then(() => {
      updateUI(pin, newState);
    });
}

/* üîÑ Synchronisation avec l'√©tat r√©el Blynk */
function syncWithBlynk() {
  for (let pin = 0; pin < 3; pin++) {
    fetch(`https://blynk.cloud/external/api/get?token=${BLYNK_TOKEN}&V${pin}`)
      .then(res => res.json())
      .then(value => {
        updateUI(pin, parseInt(value));
      })
      .catch(() => {});
  }
}

/* Synchronisation au chargement */
window.onload = () => {
  syncWithBlynk();
};

/* Synchronisation continue (toutes les 3 secondes) */
setInterval(syncWithBlynk, 3000);
</script>

</body>
</html>

